<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="Implementation of some mathematical functions." name="description" />
		<title>Somerville</title>
		<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/sidenotes.css" />
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<link rel="stylesheet" type="text/css" href="css/shThemeSidenotes.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<div class="gridlayout">
			<div class="box header">
				<h1 class="project-name">somerville.fills.flood-fill</h1>
				<a class="toc-link" href="index.html">table of contents</a>
			</div>
			<div class="box section">
				<p>Provides a simple algorithm to flood fill an area</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(ns somerville.fills.flood-fill
  (:require
    [clojure.set :as s]
    [somerville.geometry.point :as p]))</pre>
			</div>
						<div class="box section">
				<p>Filter list of points to those that are neighbours of the given point.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn neighbours
  [point]
  (list
    (p/point (- (:x point) 1)  (- (:y point) 1))
    (p/point (- (:x point) 1)     (:y point))
    (p/point (- (:x point) 1)  (+ (:y point) 1))
    (p/point    (:x point)     (- (:y point) 1))
    (p/point    (:x point)     (+ (:y point) 1))
    (p/point (+ (:x point) 1)  (- (:y point) 1))
    (p/point (+ (:x point) 1)     (:y point))
    (p/point (+ (:x point) 1)  (+ (:y point) 1))))</pre>
			</div>
						<div class="box section">
				<p>Check if a pixel is inside an image.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn in-bounds?
  [p x1 y1 x2 y2]
  (and
    (&lt;  (:x p) x2)
    (&gt;= (:x p) x1)
    (&lt;  (:y p) y2)
    (&gt;= (:y p) y1)))</pre>
			</div>
						<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn fill
  [seed previous decider-fn x1 y1 x2 y2]
  (loop [frontier #{seed}
         visited previous
         accepted #{}]
    (if (= 0 (count frontier))
      accepted
      (let [reachable (into #{} (filter #(decider-fn seed %) frontier))
            combined-frontier (into #{} (filter #(in-bounds? % x1 y1 x2 y2) (reduce concat (map #(neighbours %) reachable))))
            new-frontier (s/difference combined-frontier visited)]
        (recur new-frontier (s/union visited frontier) (s/union accepted reachable))))))</pre>
			</div>
						<div class="box section">
				<p>Attempt to do sample-size flood fills from random points. If selected point was already visited the attempt fails.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn partition-samples
  [sample-size decider-fn x1 y1 x2 y2]
  (filter
    #(&lt; 50 (count (:points %)))
    (loop [i 0
           visited #{}
           partitions '()]
      (if (= i sample-size)
        partitions
        (let [seed (p/point (rand-int (+ x1 (- x2 x1))) (rand-int (+ y1 (- y2 y1))))
              part (if (nil? (some #{seed} visited))
                     (fill seed visited decider-fn x1 y1 x2 y2)
                     #{})]
          (recur (+ i 1) (s/union visited part) (conj partitions {:seed seed :points part})))))))</pre>
			</div>
			
			<div class="box footer">
				Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.
				&nbsp;&nbsp;
				Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
			</div>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
