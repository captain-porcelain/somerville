<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="Implementation of some mathematical functions." name="description" />
		<title>Somerville</title>
		<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/sidenotes.css" />
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<link rel="stylesheet" type="text/css" href="css/shThemeSidenotes.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<div class="gridlayout">
			<div class="box header">
				<h1 class="project-name">somerville.visualization.worker</h1>
				<a class="toc-link" href="index.html">table of contents</a>
			</div>
			<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">(ns somerville.visualization.worker
  (:require
    [somerville.visualization.commons :as commons]
    [somerville.maps.gaia.core :as gaia]
    [taoensso.timbre :as log]))</pre>
			</div>
						<div class="box section span">
				Work handling for gaia
			</div>
						<div class="box section">
				<p>Create the config for gaia.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn merge-config
  [data]
  (merge gaia/default-config data))</pre>
			</div>
						<div class="box section">
				<p>Make a fibonacci point sphere.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn fibonacci
  [data]
  (gaia/fibonacci (merge-config data)))</pre>
			</div>
						<div class="box section">
				<p>Make a delaunay sphere.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn delaunay
  [data]
  (gaia/delaunay (merge-config data)))</pre>
			</div>
						<div class="box section">
				<p>Make a voronoi sphere.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn voronoi
  [data]
  (gaia/voronoi (merge-config data)))</pre>
			</div>
						<div class="box section">
				<p>Handle work requests for gaia.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn dispatch-gaia
  [message]
  (case (:command message)
    &quot;fibonacci&quot;    (fibonacci (:data message))
    &quot;delaunay&quot;     (delaunay (:data message))
    &quot;voronoi&quot;      (voronoi (:data message))))</pre>
			</div>
						<div class="box section span">
				Dispatch handling
			</div>
						<div class="box section">
				<p>Dispatch all incoming messages by requested module.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn dispatch-all
  [message]
  (try
    (case (:module message)
      &quot;gaia&quot; (dispatch-gaia message)
      (log/info &quot;Don't know module &quot; (:module message)))
    (catch js/Object e &quot;Error in worker&quot;)))</pre>
			</div>
						<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn handle-message
  [msg]
  (let [message (commons/to-clojurescript (.-data msg))
        tmp (log/info &quot;Received work message &quot; (:module message) &quot; -&gt; &quot; (:command message))
        result (dispatch-all message)]
    (.postMessage js/self (commons/to-arraybuffer (assoc message :result result)))))</pre>
			</div>
						<div class="box section">
				<p>Start the worker message processing.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn start
  []
  (set! (.-onmessage js/self) handle-message)
  (.postMessage js/self (commons/to-arraybuffer {:command &quot;worker-start&quot;})))</pre>
			</div>
						<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">(start)</pre>
			</div>
			
			<div class="box footer">
				Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.
				&nbsp;&nbsp;
				Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
			</div>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
