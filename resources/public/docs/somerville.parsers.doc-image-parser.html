<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="Implementation of some mathematical functions." name="description" />
		<title>Somerville</title>
		<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/sidenotes.css" />
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<link rel="stylesheet" type="text/css" href="css/shThemeSidenotes.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<div class="gridlayout">
			<div class="box header">
				<h1 class="project-name">somerville.parsers.doc-image-parser</h1>
				<a class="toc-link" href="index.html">table of contents</a>
			</div>
			<div class="box section">
				<p>Handle parsing image descriptions for inclusion in the sidenotes documentation.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(ns somerville.parsers.doc-image-parser
  (:require
    [somerville.geometry.point :as point]
    [somerville.geometry.line :as line]
    [somerville.geometry.circle :as circle]
    [somerville.geometry.arc :as arc]
    [somerville.color.color :as color]
    [clojure.edn :as edn]
    [taoensso.timbre :as log]))</pre>
			</div>
						<div class="box section">
				<p>Parse a color from the definitions.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn parse-colors
  [colors]
  (into {} (map (fn [[k v]] [k (apply color/rgba v)]) colors)))</pre>
			</div>
						<div class="box section">
				<p>Recursively parse objects. Assume that an object is defined as a vector with a keyword and parameters which can be translated into function calls.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn parse-object
  [o objects]
  (cond
    (vector? o) (case (first o)
                  :point (apply point/point (map #(parse-object % objects) (rest o)))
                  :line (apply line/line (map #(parse-object % objects) (rest o)))
                  :circle (apply circle/circle (map #(parse-object % objects) (rest o)))
                  :arc (apply arc/arc (map #(parse-object % objects) (rest o)))
                  :arc-lines (apply arc/from-lines (map #(parse-object % objects) (rest o)))
                  o)
    (not (nil? (get objects o))) (get objects o)
    :else o))</pre>
			</div>
						<div class="box section">
				<p>Parse the object definitions and resolve references.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn parse-objects
  [definitions]
  (loop [ds definitions
         objects {}]
    (if (= 0 (count ds))
      objects
      (let [[k o] (first ds)
            po (parse-object o objects)]
        (recur (rest ds) (assoc objects k po))))))</pre>
			</div>
						<div class="box section">
				<p>Parse the rendering definitions based on defined objects.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn parse-renderings
  [renderings objects colors]
  (map #(assoc % :object ((:object %) objects) :color ((:color %) colors)) renderings))</pre>
			</div>
						<div class="box section">
				<p>Parse the given text into definitions and resolve references to previous objects.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn parse
  [text]
  (let [raw (edn/read-string text)
        objects (parse-objects (:definitions raw))
        colors (parse-colors (:colors raw))
        renderings (parse-renderings (:renderings raw) objects colors)]
    {:name (:name raw)
     :object objects
     :colors colors
     :renderings renderings}))</pre>
			</div>
			
			<div class="box footer">
				Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.
				&nbsp;&nbsp;
				Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
			</div>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
