<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" content="text/html" http-equiv="Content-Type" />
		<meta content="Implementation of some mathematical functions." name="description" />
		<title>Somerville</title>
		<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="css/sidenotes.css" />
 		<link rel="stylesheet" type="text/css" href="css/shCore.css" />
		<link rel="stylesheet" type="text/css" href="css/shThemeSidenotes.css" />
		<style type="text/css">.syntaxhighlighter{overflow:hidden !important;}</style>
		<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
		<script type="text/javascript" src="js/xregexp-min.js"></script>
		<script type="text/javascript" src="js/shCore.js"></script>
		<script type="text/javascript" src="js/shBrushClojure.js"></script>
	</head>
	<body>
		<div class="gridlayout">
			<div class="box header">
				<h1 class="project-name">somerville.geometry.projection.projection</h1>
				<a class="toc-link" href="toc.html">table of contents</a>
			</div>
			<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">My own projection
First set up the camera at a point and a projection plane.
Then intersect the line from the camera to the point that is to be projected onto the plane.
Lastly transform the point from the plane into a 2d view by calculating a linear combination of the vector from the center
to that point that is then retransformed to a vector with the corresponding vectors in the 2d plane.</pre>
			</div>
			<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">(ns somerville.geometry.projection.projection
  (:require
    [somerville.geometry.line :as l]
    [somerville.geometry.point :as p]
    [somerville.geometry.plane :as pl]
    [somerville.geometry.commons :as c]))</pre>
			</div>
			<div class="box section">
				
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defrecord Projector [camera focus up projection-plane screen-center width height horizontal-base vertical-base]
  c/Printable
  (c/out [this i] (str (c/indent i) &quot;Projector settings\\n&quot;
                       &quot;Camera at &quot; (c/out camera) &quot;\\n&quot;
                       &quot;Focussing on &quot; (c/out focus) &quot;\\n&quot;
                       &quot;Plane up is &quot; (c/out up) &quot;\\n&quot;
                       &quot;Projection plane is &quot; (c/out projection-plane) &quot;\\n&quot;
                       &quot;Screen center is &quot; (c/out screen-center) &quot;\\n&quot;
                       &quot;Screen dimensions are &quot; width &quot;x&quot; height &quot;\\n&quot;
                       &quot;Horizontal base is &quot; (c/out horizontal-base) &quot;\\n&quot;
                       &quot;Vertical base is &quot; (c/out vertical-base)))
  (c/out [this] (c/out this 0)))</pre>
			</div>
			<div class="box section">
				<p>Calculate the projection plane for the given camera and focus points considering the orientation given by up.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn projection-plane
  [camera focus up distance]
  (let [v1 (p/scale (p/normalize (p/subtract focus camera)) distance)
        v2 (p/add (p/add camera v1) up)
        v3 (p/cross v1 v2)]
    (pl/plane focus v2 v3)))</pre>
			</div>
			<div class="box section">
				<p>Create a projector that looks from the camera point to the focus point and a screen of width x height. The orientation of the screen plane is determined by the up vector.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn projector
  [camera focus up distance width height]
  (Projector.
    camera focus up
    (projection-plane camera focus up distance)
    (p/point (/ width 2) (/ height 2))
    width height
    (p/normalize (p/cross (p/subtract focus camera) up))
    (p/normalize up)))</pre>
			</div>
			<div class="box section">
				<p>Project the given point using the projector settings.</p>
			</div>
			<div class="box section">
				<pre class="brush: clojure">(defn project
  [projector point]
  (let [i (pl/intersect (:projection-plane projector) (l/line (:camera projector) point))
        vi (p/subtract i (:focus projector))
        [a b] (p/linear-combination vi (:horizontal-base projector) (:vertical-base projector))
        p2d (p/add (p/add (:screen-center projector) (p/point a 0)) (p/point 0 b))]
    p2d))</pre>
			</div>
			<div class="box footer">
				Generated by <a href="https://github.com/captain-porcelain/sidenotes">Sidenotes</a>.
				&nbsp;&nbsp;
				Syntax highlighting provided by Alex Gorbatchev's <a href="http://alexgorbatchev.com/SyntaxHighlighter/">SyntaxHighlighter</a>
			</div>
		</div>
		<script type="text/javascript" src="js/app.js"></script>
	</body>
</html>
